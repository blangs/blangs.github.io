---
title:  "ë¦¬ì•¡íŠ¸ ìµœì í™”(3) immer"
excerpt: "ë¦¬ì•¡íŠ¸ ìµœì í™”(3) immer ìž…ë‹ˆë‹¤."

categories:
  - react
tags:
  - [react]

toc: true
toc_sticky: true

last_modified_at: 2023-08-04T09:00:00-18:00:00
---

## immer ëž€?
> â—***immer(ì´ë¨¸)***  
> ðŸ’¡ JavaScriptì—ì„œ ë¶ˆë³€ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ìƒíƒœë¥¼ ê°„íŽ¸í•˜ê²Œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìžˆë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬.  
> ðŸ’¡ immerëŠ” ë³µìž¡í•œ ì¤‘ì²©ëœ ê°ì²´ë‚˜ ë°°ì—´ì„ ë‹¤ë£° ë•Œ ì½”ë“œë¥¼ ë” ì½ê¸° ì‰½ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰½ê²Œ ë§Œë“ ë‹¤.  

## ë¶ˆë³€ì„± ìž¬í•™ìŠµ  
### ì˜ˆì œ1 (ë¶ˆë³€ì„± ì§€í‚¤ê¸° ê¸°ë³¸) 

```js
const object = {
  a: 1,
  b: 2
};

object.b = 3;

```  
> âš ï¸ ì´ë ‡ê²Œ ì§ì ‘ ìˆ˜ì •í•˜ë©´ ì•ˆë˜ê³  !

```js
const object = {
  a: 1,
  b: 2
};

const nextObject = {
  ...object,
  b: 3
};

```
> ðŸ’¡ ì´ë ‡ê²Œ ì–•ì€ë³µì‚¬ë¡œ ì‚¬ìš©í•´ì„œ ë¶ˆë©´ì„±ì„ ì§€í‚¤ë©° ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ê³  ìˆ˜ì •í•´ì•¼í•œë‹¤.
  
### ì˜ˆì œ2 (ë¶ˆë³€ì„± ì§€í‚¤ê¸° ë°°ì—´)  
```js
const todos = [
  {
    id: 1,
    text: 'í•  ì¼ #1',
    done: true
  }}
];
const inserted = todos.concat({
  id: 3,
  text: 'í•  ì¼ #3',
  done: false
});

```

> ðŸ’¡ ë°°ì—´ë„ concat ì„ ì‚¬ìš©í•´ì„œ ë¶ˆë©´ì„±ì„ ì§€í‚¤ë©° ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ê³  ìˆ˜ì •í•´ì•¼í•œë‹¤.  
> ðŸ’¡ push, splice ë“±ì˜ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ n ë²ˆì§¸ í•­ëª©ì„ ì§ì ‘ ìˆ˜ì •í•˜ë©´ ì•ˆëœë‹¤.

### ì˜ˆì œ2 (ë¶ˆë³€ì„± ì§€í‚¤ê¸° ë°°ì—´ ì‹¬í™”)  
```js
const state = {
  posts: [
    {
      id: 1,
      title: 'ì œëª©ìž…ë‹ˆë‹¤.',
      body: 'ë‚´ìš©ìž…ë‹ˆë‹¤.',
      comments: [
        {
          id: 1,
          text: 'ì™€ ì •ë§ ìž˜ ì½ì—ˆìŠµë‹ˆë‹¤.'
        }
      ]
    },
    {
      id: 2,
      title: 'ì œëª©ìž…ë‹ˆë‹¤.',
      body: 'ë‚´ìš©ìž…ë‹ˆë‹¤.',
      comments: [
        {
          id: 2,
          text: 'ë˜ ë‹¤ë¥¸ ëŒ“ê¸€ ì–´ì©Œê³  ì €ì©Œê³ '
        }
      ]
    }
  ],
  selectedId: 1
};

```

> ðŸ’¡ ìœ„ ì½”ë“œì—ì„œ posts ë°°ì—´ ì•ˆì˜ id ê°€ 1 ì¸ post ê°ì²´ë¥¼ ì°¾ì•„ì„œ, comments ì— ìƒˆë¡œìš´ ëŒ“ê¸€ ê°ì²´ë¥¼ ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤ë©´? 

```js
// ë°©ë²•1
const nextState = {
  ...state,
  posts: state.posts.map(post =>
    post.id === 1
      ? {
          ...post,
          comments: post.comments.concat({ id: 2, text: 'ìƒˆë¡œìš´ ëŒ“ê¸€' })
        }
      : post
  )
};

```
```js
// ë°©ë²•2
const info = {
  id: 2,
  text: 'ìƒˆë¡œìš´ ëŒ“ê¸€'
};

const nextState = {
  ...state,
  posts: state.posts.map(post =>
    post.id === 1
      ? {
          ...post,
          comments: post.comments.concat(info)
        }
      : post
  )
};

```


> ðŸ’¡ ìœ„ ì²˜ëŸ¼ ë¶ˆë³€ì„± í•˜ë‚˜ ì§€í‚¤ëŠ”ë° ì§„ì§œ ë³µìž¡í•˜ë‹¤.  
> ðŸ’¡ì´ëŸ´ ë•Œ, immer ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì—„ì²­ íŽ¸í•˜ê²Œ ë¶ˆë³€ì„± ì¡°ìž‘ì´ ê°€ëŠ¥í•˜ë‹¤.


## Immer ì‚¬ìš©ë²•
### STEP1. yarn add immer
```bash
yarn add immer

```
```js
import produce from 'immer';

```
> ðŸ’¡ì½”ë“œì˜ ìƒë‹¨ì—ì„œ immer ë¥¼ ìœ„ ì²˜ëŸ¼ ì‚¬ìš©í•œë‹¤.  
> ðŸ’¡ë³´í†µ produce ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¨ë‹¤.  



### STEP2. ì½”ë“œ
```js
import produce from "immer";

const state = {
  number: 1,
  dontChangeMe: 2
};

const nextState = produce(state, draft => {
  draft.dontChangeMe += 1;
});

console.log(nextState);

```

> â—***ì´ë¨¸ íŒŒë¼ë¯¸í„°ê°’***  
> 1. ðŸ’¡param1: ìˆ˜ì •í•˜ê³  ì‹¶ì€ ìƒíƒœ  
> 2. ðŸ’¡param2: ì–´ë–»ê²Œ ì—…ë°ì´íŠ¸í•˜ê³  ì‹¶ì„ì§€ ì •ì˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë„£ëŠ”ë‹¤.  
> 3. ðŸ’¡ë¶ˆë³€ì„± ì‹ ê²½ì“°ì§€ ì•Šê³  ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•˜ë‹¤. ë.   


## AS-IS, TO-BE ë¹„êµ
### onChange() í•¨ìˆ˜
```js
/* AS-IS */
const onChange = useCallback(
    e => {
        const { name, value } = e.target;
        setForm({
            ...form,
            [name]: [value]
        });
    },
    [form]
);
```
```js
/* TO-BE */
const onChange = useCallback(e => {
  const { name, value } = e.target;
  setForm(
    produce(draft => {
      draft[name] = value;
    })
  );
}, []);

```


### onSubmit() í•¨ìˆ˜
```js
/* AS-IS */
// form ë“±ë¡ì„ ìœ„í•œ í•¨ìˆ˜
const onSubmit = useCallback(
    e => {
        e.preventDefault();
        // ê°±ì‹ í•  ê°’
        const info = {
            id: nextId.current += 1,
            name: form.name,
            username: form.username
        };
        // array ì— ìƒˆ í•­ëª© ë“±ë¡
        setData({
            ...data,
            array: data.array.concat(info)
            /*
            // ì´ë ‡ê²Œë„ ê°€ëŠ¥ !
            array: data.array.concat({
                id: nextId.current += 1,
                name: form.name,
                username: form.username
            })
            */
        });
        // form ì´ˆê¸°í™”
        setForm({
            name: '',
            username: ''
        });
    }, [data, form.name, form.username]
);

```
```js
/* TO-BE */
const onSubmit = useCallback(
  e => {
    e.preventDefault();
    // ê°±ì‹ í•  ê°’
    const info = {
      id: nextId.current += 1,
      name: form.name,
      username: form.username
    };
    // array ì— ìƒˆ í•­ëª© ë“±ë¡
    setData(
      produce(draft => {
        draft.array.push(info);
      })
    );
    // form ì´ˆê¸°í™”
    setForm({
      name: '',
      username: ''
    });
  },
  [form.name, form.username]
);

```


### ì‚­ì œ
```js
/* AS-IS */
const onRemove = useCallback(
    id => {
        setData({
            ...data,
            array: data.array.filter(info => info.id !id)
        });
    }, [data]
);

```
```js
/* TO-BE */
const onRemove = useCallback(
  id => {
    setData(
      produce(draft => {
        draft.array.splice(draft.array.findIndex(info => info.id === id), 1);
      })
    );
  },
  []
);

```

> â—***splice()***  
> ðŸ’¡ ì‹œìž‘ì¸ë±ìŠ¤ ë¶€í„° ~ ì§€ì • ê°¯ìˆ˜ë§Œí¼ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë°°ì—´ë¡œ ë°˜í™˜   
> - param1: ì‹œìž‘ ì¸ë±ìŠ¤   
> - param2: ì œê±°í•  ìš”ì†Œì˜ ê°œìˆ˜  
>  
> â—***ì˜ˆì œ***  
> ```js
> const fruits = ['apple', 'banana', 'orange', 'grape', 'kiwi']; 
> 
> const removedFruits = fruits.splice(1, 2);
> 
> ```
> ```js
> // ìˆ˜í–‰ í›„ 
> console.log(fruits);
> ê²°ê³¼: ['apple', 'grape', 'kiwi'] 
> 
> console.log(removedFruits);
> ê²°ê³¼: ['banana', 'orange']
> 
> ```
>   


