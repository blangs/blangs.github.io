---
title:  "ìŠ¤í”„ë§ ì—ëŸ¬ì²˜ë¦¬(1)"
excerpt: "ìŠ¤í”„ë§ ì—ëŸ¬ì²˜ë¦¬(1) ì…ë‹ˆë‹¤."

categories:
  - spring
tags:
  - [spring, í”„ë ˆì„ì›Œí¬]

toc: true
toc_sticky: true

last_modified_at: 2024-07-12T13:17:00-17:00:00
---


## ê°œìš”
> â—<span style='color:green'>***WASë‚´ì˜ ë§ˆì´ë°”í‹°ìŠ¤ë¡œ ìš´ì˜ë˜ëŠ” DB1 DB2 íŠ¸ëœì­ì…˜ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.***</span>  
> ğŸ’¡ 1.<span style='color:blue'>**ì„œë¡œì˜ ì„¸ì…˜ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì„ì„ í™•ì¸ í•¨.**</span>  



## êµ¬í˜„
### GlobalExceptionHandler.java : Exception ì „ì—­ ì²˜ë¦¬
```java
/*
	 * 1. ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°œìƒí•˜ëŠ” (@ControllerAdvice ìœ¼ë¡œ ì¸í•´. ì»´í¬ë„ŒíŠ¸ìŠ¤ìº”ê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ë¯€ë¡œ Beanì£¼ì…ì´ ë˜ì–´ìˆìŒ.) 
	 * 2. ìµì…‰ì…˜ë“¤ì„ @ExceptionHandler(í´ë˜ìŠ¤ëª…) ìœ¼ë¡œ í•„í„°ë§ë˜ì–´ ì„ í–‰ì²˜ë¦¬ ëœë‹¤.
*/
@ControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

	/** javax.validation.Valid or @Validated ìœ¼ë¡œ binding error ë°œìƒì‹œ ë°œìƒí•œë‹¤. **/
    @ExceptionHandler(MethodArgumentNotValidException.class)
    protected ResponseEntity<ErrorResponse> handleMethodArgumentNotValidException(MethodArgumentNotValidException e) {
        log.error("handleMethodArgumentNotValidException", e);
        final ErrorResponse response = ErrorResponse.of(ErrorCode.INVALID_INPUT_VALUE, e.getBindingResult());
        return new ResponseEntity<>(response, HttpStatus.BAD_REQUEST);
    }
    /** @ModelAttribut ìœ¼ë¡œ binding error ë°œìƒì‹œ BindException ë°œìƒí•œë‹¤. **/
    @ExceptionHandler(BindException.class)
    protected ResponseEntity<ErrorResponse> handleBindException(BindException e) {
        final ErrorResponse response = ErrorResponse.of(ErrorCode.INVALID_INPUT_VALUE, e.getBindingResult());
        return new ResponseEntity<>(response, HttpStatus.BAD_REQUEST);
    }
	/** enum type ì¼ì¹˜í•˜ì§€ ì•Šì•„ binding ëª»í•  ê²½ìš° ë°œìƒ **/
    @ExceptionHandler(MethodArgumentTypeMismatchException.class)
    protected ResponseEntity<ErrorResponse> handleMethodArgumentTypeMismatchException(MethodArgumentTypeMismatchException e) {
        log.error("handleMethodArgumentTypeMismatchException", e);
        final ErrorResponse response = ErrorResponse.of(e);
        return new ResponseEntity<>(response, HttpStatus.BAD_REQUEST);
    }
	/** ì§€ì›í•˜ì§€ ì•Šì€ HTTP method í˜¸ì¶œ í•  ê²½ìš° ë°œìƒ **/
    @ExceptionHandler(HttpRequestMethodNotSupportedException.class)
    protected ResponseEntity<ErrorResponse> handleHttpRequestMethodNotSupportedException(HttpRequestMethodNotSupportedException e) {
        log.error("handleHttpRequestMethodNotSupportedException", e);
        final ErrorResponse response = ErrorResponse.of(ErrorCode.METHOD_NOT_ALLOWED);
        return new ResponseEntity<>(response, HttpStatus.METHOD_NOT_ALLOWED);
    }

	/** Authentication ê°ì²´ê°€ í•„ìš”í•œ ê¶Œí•œì„ ë³´ìœ í•˜ì§€ ì•Šì€ ê²½ìš° ë°œìƒí•© **/
    @ExceptionHandler(AccessDeniedException.class)
    protected ResponseEntity<ErrorResponse> handleAccessDeniedException(AccessDeniedException e) {
        log.error("handleAccessDeniedException", e);
        final ErrorResponse response = ErrorResponse.of(ErrorCode.HANDLE_ACCESS_DENIED);
        return new ResponseEntity<>(response, HttpStatus.valueOf(ErrorCode.HANDLE_ACCESS_DENIED.getStatus()));
    }

    /** [ì»¤ìŠ¤í…€ìµì…‰ì…˜] BusinessExceptionì—ì„œ ë°œìƒí•œ ì—ëŸ¬ **/
    @ExceptionHandler(BusinessExceptionHandler.class)
    protected ResponseEntity<ErrorResponse> handleCustomException(final BusinessExceptionHandler e) {
        final ErrorCode errorCode = e.getErrorCode();
        final ErrorResponse response = ErrorResponse.of(errorCode); //ex)ENTITY_NOT_FOUND
        return new ResponseEntity<>(response, HttpStatus.valueOf(errorCode.getStatus()));
    }

    /** [ê·¸ì™¸ ì „ì²´ Exception] ëª¨ë“  Exception ê²½ìš° ë°œìƒ **/
    @ExceptionHandler(Exception.class)
    protected ResponseEntity<ErrorResponse> handleException(Exception ex) {
        //final ErrorResponse response = ErrorResponse.of(ErrorCode.INTERNAL_SERVER_ERROR);
        final ErrorResponse response = ErrorResponse.of(ErrorCode.INTERNAL_SERVER_ERROR, ex.getMessage());
        return new ResponseEntity<>(response, HttpStatus.INTERNAL_SERVER_ERROR);
    }
    
}

```
  
> â—<span style='color:green'>***Exception ì „ì—­ì²˜ë¦¬***</span>  
> ğŸ’¡ <span style='color:blue'>1.**ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°œìƒí•˜ëŠ” (@ControllerAdvice ìœ¼ë¡œ ì¸í•´. ì»´í¬ë„ŒíŠ¸ìŠ¤ìº”ê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ë¯€ë¡œ Beanì£¼ì…ì´ ë˜ì–´ìˆìŒ.)**</span>  
> ğŸ’¡ <span style='color:blue'>2.**ìµì…‰ì…˜ë“¤ì„ @ExceptionHandler(í´ë˜ìŠ¤ëª…) ìœ¼ë¡œ í•„í„°ë§ë˜ì–´ ì„ í–‰ì²˜ë¦¬ ëœë‹¤.**</span>  
>   
> â—<span style='color:green'>***Exception Wrapping ì²˜ë¦¬í•˜ì—¬ ì‘ë‹µ***</span>  
> ğŸ’¡ <span style='color:blue'>**ì§ì ‘ë§Œë“  ErrorResponse í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ jsoní¬ë§·ìœ¼ë¡œ wrapping í•œë‹¤**</span>  
> ğŸ’¡ <span style='color:blue'>**ê³µí†µ ê·œì•½ëœ ì—ëŸ¬ë©”ì„¸ì§€ë¥¼ ì „ë‹¬ í•  ìˆ˜ ìˆë‹¤.**</span>  
  
1.ì¼ë¶€ì˜ Exception ì„ ê°ì§€í•˜ë„ë¡ ì²˜ë¦¬í•˜ê³ ìˆë‹¤.  
2.ì»¤ìŠ¤í…€í•œ handleCustomException ê°ì§€í•˜ë„ë¡ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.   
3.ê·¸ì™¸ ì „ì²´ Exception.class ìì²´ë¥¼ ì¡ì•„ì„œ ê°ì§€í•˜ë„ë¡ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.  
{: .notice--info}

 
### ErrorResponse.java : Exception ë™ì¼í•œ í¬ë§·ì²˜ë¦¬(Wrapping)
```java
/**
 * Error Response
 * ê°„í˜¹ Map<Key, Value> í˜•ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ”ë° ì´ëŠ” ì¢‹ì§€ ì•Šë‹¤. 
 * ìš°ì„  Map ì´ë¼ëŠ” ì¹œêµ¬ëŠ” ëŸ°íƒ€ì…ì‹œì— ì •í™•í•œ í˜•íƒœë¥¼ ê°–ì¶”ê¸° ë•Œë¬¸ì— ê°ì²´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°œë°œìë“¤ë„ ì •í™•íˆ ë¬´ìŠ¨ í‚¤ì— ë¬´ìŠ¨ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ì–´ë µë‹¤.
 * ë¦¬í„´ íƒ€ì…ì´ ResponseEntity<ErrorResponse> ìœ¼ë¡œ ë¬´ìŠ¨ ë°ì´í„°ê°€ ì–´ë–»ê²Œ ìˆëŠ”ì§€ ëª…í™•í•˜ê²Œ ì¶”ë¡ í•˜ê¸° ì‰½ë„ë¡ êµ¬ì„±í•˜ëŠ” ê²Œ ë°”ëŒì§í•˜ë‹¤.
 * 
 * ì´ í´ë˜ìŠ¤ì˜ ë‚´ìš©ì„ POJO ê°ì²´ë¡œ ê´€ë¦¬í•˜ë©´ errorResponse.getXXX(); ì´ë ‡ê²Œ ëª…í™•í•˜ê²Œ ê°ì²´ì— ìˆëŠ” ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. 
 * ê·¸ ë°–ì— íŠ¹ì • Exceptionì— ëŒ€í•´ì„œ ErrorResponse ê°ì²´ë¥¼ ì–´ë–»ê²Œ ë§Œë“¤ ê²ƒì¸ê°€ì— ëŒ€í•œ ì±…ì„ì„ ëª…í™•í•˜ê²Œ ê°–ëŠ” êµ¬ì¡°ë¡œ ì„¤ê³„í•  ìˆë‹¤.
 */
/**
 * Global Exception Handlerì—ì„œ ë°œìƒí•œ ì—ëŸ¬ì— ëŒ€í•œ ì‘ë‹µ ì²˜ë¦¬ë¥¼ ê´€ë¦¬
 */
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class ErrorResponse {

	private int status;                // ì—ëŸ¬ ìƒíƒœ ì½”ë“œ
	private String code;			   // ì—ëŸ¬ êµ¬ë¶„ ì½”ë“œ
    private String message;            // ì—ëŸ¬ ë©”ì‹œì§€
    private List<FieldError> errors;   // ìƒì„¸ ì—ëŸ¬ ë©”ì‹œì§€
    private String reason;             // ì—ëŸ¬ ì´ìœ  (ì¶”ê°€)


    
    /**********************************************************************************************
     * ìƒì„±ì
     **********************************************************************************************/
    /* ErrorResponse ìƒì„±ì-1*/
    private ErrorResponse(final ErrorCode code) {
        this.message = code.getMessage();
        this.status = code.getStatus();
        this.code = code.getCode();
        this.errors = new ArrayList<>();
    }
    
    /* ErrorResponse ìƒì„±ì-2 */
    protected ErrorResponse(final ErrorCode code, final String reason) {
        this.message = code.getMessage();
        this.status = code.getStatus();
        this.code = code.getCode();
        this.reason = reason;
    }
    
    /* ErrorResponse ìƒì„±ì-3 */
    private ErrorResponse(final ErrorCode code, final List<FieldError> errors) {
        this.message = code.getMessage();
        this.status = code.getStatus();
        this.errors = errors;
        this.code = code.getCode();
    }

    /**********************************************************************************************
     * Global Exception ì „ì†¡ íƒ€ì…
     **********************************************************************************************/
    /* Global Exception ì „ì†¡ íƒ€ì…-1 */
    public static ErrorResponse of(final ErrorCode code, final BindingResult bindingResult) {
        return new ErrorResponse(code, FieldError.of(bindingResult));
    }

    /* Global Exception ì „ì†¡ íƒ€ì…-2 */
    public static ErrorResponse of(final ErrorCode code) {
        return new ErrorResponse(code);
    }

    // ? 
    public static ErrorResponse of(final ErrorCode code, final List<FieldError> errors) {
        return new ErrorResponse(code, errors);
    }

    /* Global Exception ì „ì†¡ íƒ€ì…-3 */
    public static ErrorResponse of(final ErrorCode code, final String reason) {
        return new ErrorResponse(code, reason);
    }

	/** Global Exception ì „ì†¡ íƒ€ì…-4 (enum type ì¼ì¹˜í•˜ì§€ ì•Šì•„ binding ëª»í•  ê²½ìš° ë°œìƒ) **/
    public static ErrorResponse of(MethodArgumentTypeMismatchException e) {
        final String value = e.getValue() == null ? "" : e.getValue().toString();
        final List<ErrorResponse.FieldError> errors = ErrorResponse.FieldError.of(e.getName(), value, e.getErrorCode());
        return new ErrorResponse(ErrorCode.INVALID_TYPE_VALUE, errors);
    }
    
    /**********************************************************************************************
     * POJO
	 * ì—ëŸ¬ë¥¼ e.getBindingResult() í˜•íƒœë¡œ ì „ë‹¬ ë°›ëŠ” ê²½ìš° í•´ë‹¹ ë‚´ìš©ì„ ìƒì„¸ ë‚´ìš©ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œë‹¤.
	 * ì´ í´ë˜ìŠ¤ì˜ ë‚´ìš©ì„ POJO ê°ì²´ë¡œ ê´€ë¦¬í•˜ë©´ errorResponse.getXXX(); ì´ë ‡ê²Œ ëª…í™•í•˜ê²Œ ê°ì²´ì— ìˆëŠ” ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. 
     **********************************************************************************************/
    @Getter
    @NoArgsConstructor(access = AccessLevel.PROTECTED)// ìƒì„±ìë¥¼ í†µí•´ì„œ ê°’ ë³€ê²½ ëª©ì ìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ” ë©”ì‹œì§€ë“¤ ì°¨ë‹¨ ì–´ë…¸í…Œì´ì…˜
    public static class FieldError {
        private String field;
        private String value;
        private String reason;

        private FieldError(final String field, final String value, final String reason) {
            this.field = field;
            this.value = value;
            this.reason = reason;
        }

        public static List<FieldError> of(final String field, final String value, final String reason) {
            List<FieldError> fieldErrors = new ArrayList<>();
            fieldErrors.add(new FieldError(field, value, reason));
            return fieldErrors;
        }

		/**
		 * ì•„ë˜ ì½”ë“œì™€ ë™ì¼í•œ íš¨ê³¼
		 * 
		 * List<FieldError> fieldErrorList = Arrays.asList(
   		 * new FieldError("username", "", "Username cannot be empty"),
    	 * new FieldError("age", "-1", "Age must be positive")
		 * );
		 */
        private static List<FieldError> of(final BindingResult bindingResult) {
            final List<org.springframework.validation.FieldError> fieldErrors = bindingResult.getFieldErrors();
            return fieldErrors.stream()
                    .map(error -> new FieldError(
                            error.getField(),
                            error.getRejectedValue() == null ? "" : error.getRejectedValue().toString(),
                            error.getDefaultMessage()))
                    .collect(Collectors.toList());
        }
    }
}

```

> â—<span style='color:green'>***Exception Wrapping ì²˜ë¦¬***</span>  
> ğŸ’¡ <span style='color:blue'>1.**ìƒì„±ìë¥¼ ë§Œë“¤ê³ **</span>  
> ğŸ’¡ <span style='color:blue'>2.**ErrorResponseê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ëª©ì ì˜ ì—¬ëŸ¬ ë©”ì†Œë“œë¥¼ ë§Œë“ ë‹¤. (ë©”ì†Œë“œëŠ” ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ì—¬ ì´ˆê¸°í™”)**</span>  
> ğŸ’¡ <span style='color:blue'>3.**ê·¸ ì¤‘ BindingResult í˜•íƒœë¡œ ë©”ì†Œë“œê°€ í˜¸ì¶œë˜ë©´ POJOì˜ FieldError ê¸°ëŠ¥ìœ¼ë¡œ ì¡°ë¦½í•˜ì—¬ ìƒì„¸í•œ ë‚´ìš©ì„ ë¦¬í„´í•œë‹¤.**</span>  
>   
> â—<span style='color:green'>***BindingResultëŠ” ë­˜ê¹Œ***</span>  
> ![ì‚¬ì§„1](/assets/images/WebProgramming/Spring/spring-error-bindingresult.png)  
> ğŸ’¡ <span style='color:blue'>1.**ì˜ˆë¥¼ë“¤ì–´ @Valid ì˜ ê²½ìš°ì—ëŠ” MethodArgumentNotValidException ì„ ë°œìƒì‹œí‚¨ë‹¤.**</span>  
> ğŸ’¡ <span style='color:blue'>2.**MethodArgumentNotValidException ì—ëŠ” ì—¬ëŸ¬ ê°’ë“¤ì´ ìˆìœ¼ë©°, ê·¸ ì¤‘ BindingResult ë¼ëŠ” ê°ì²´ì— ì˜ˆì™¸ì— ëŒ€í•œ ì¢€ ë” ìì„¸í•˜ê³  ë§ì€ ì •ë³´ë“¤ì´ ë‹´ê²¨ìˆë‹¤.**</span>  
> ğŸ’¡ <span style='color:blue'>3.**BindingResult ê°ì²´ ì•ˆì—ì„œ error ì™€ ê´€ë ¨ëœ í•„ìš”í•œ ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ BindingResult.getFieldErrors() ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ì—¬ BindingResult ê°€ ê°–ê³  ìˆëŠ” errors ë¥¼ FieldError ë¼ëŠ” ê°ì²´ í˜•íƒœë¡œ ë°˜í™˜ë°›ê³ **</span>  
> ğŸ’¡ <span style='color:blue'>4.**FieldError ê°ì²´ì—ì„œ í•„ìš”í•œ ê°’ë“¤ì„ ì‚¬ìš©ì(ê°œë°œì) ê°€ ì •ì˜í•œ ì˜ˆì™¸ ê°ì²´ì— ë§¤í•‘í•˜ì—¬ ì‚¬ìš©í•œë‹¤.**</span>  
>   - Field : ê°ì²´ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•œ field
>   - RejectedValue : ì–´ë–¤ ê°’ìœ¼ë¡œ ì¸í•´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì˜€ëŠ”ì§€
>   - DefaultMessage : í•´ë‹¹ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì œê³µí•  message ëŠ” ë¬´ì—‡ì¸ì§€
>         
  
1. í•µì‹¬ì€ ErrorCodeë¼ëŠ” Enumì„ ë°›ì•„ì„œ í•´ë‹¹ classë¥¼ ìƒì„±í•˜ë„ë¡ êµ¬í˜„í•œë‹¤.  
2. Enumì„ í†µí•´ì„œ í•œëˆˆì— ë³¼ ìˆ˜ ìˆìœ¼ë©° ë¦¬í„´ëœ ë‚´ìš©ì˜ í˜•ì‹ì´ ì¼ì¹˜í•œë‹¤.  
3. BindingResult í˜•íƒœëŠ” e.getBindingResult() í˜•íƒœë¡œ ë“¤ì–´ì˜¤ëŠ” ê²½ìš°ì´ë‹¤. ì´ëŠ” Spring Frameworkì—ì„œ form íƒœê·¸ ê²€ì¦ ê²°ê³¼ë¥¼ ë‹´ê³  ìˆëŠ” ê°ì²´ì´ë‹¤.  
{: .notice--info}
