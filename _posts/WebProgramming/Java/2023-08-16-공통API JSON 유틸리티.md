---
title:  "ê³µí†µAPI JSON ìœ í‹¸ë¦¬í‹°"
excerpt: "ê³µí†µAPI JSON ìœ í‹¸ë¦¬í‹° ì…ë‹ˆë‹¤."

categories:
  - java
tags:
  - [java]

toc: true
toc_sticky: true

last_modified_at: 2023-08-16T09:00:00-18:00:00
---

## HomeController.java
```java
import íŒ¨í‚¤ì§€.util.HttpUtil;
import íŒ¨í‚¤ì§€.util.StringUtil;

```

### getYarnResourceData()
```java

private static final YARN_RESOURCE_METRIC = "http://ì£¼ì†Œ:í¬íŠ¸/ws/v1/cluster/metrics/";
private static final YARN_RESOURCE_INFO = "http://ì£¼ì†Œ:í¬íŠ¸/ws/v1/cluster/info/";
private static final YARN_RESOURCE_APP = "http://ì£¼ì†Œ:í¬íŠ¸/ws/v1/cluster/app/";

/*********************
 * GET Yarn Resource Manager REST API
 * ì‘ë‹µëœ JSON ê²°ê³¼ë¥¼ íŒŒì‹±í•˜ê³  í”„ë¡ íŠ¸ë¡œ ë„˜ê¸´ë‹¤.
 * 
 * @param 
 * @return List<Map<String, Object>>
 * @throws
 *********************/
@ResponseBody
@RequestMapping(value="/getYarnResourceData",method = RequestMethod.POST)
public List<Map<String, Object>> getYarnResourceData() throws Exception{
	
  logger.info("HomeController getYarnResourceData start  >>");
  
  List<Map<String, Object>> resultList = new ArrayList<Map<String, Object>>();
    
  try {
    // Yarn Resource Manager REST API (JSON ROOT KEY)
    // ìµœìƒìœ„ keyëŠ” ê³µì‹í™ˆí˜ì´ì§€ì—ì„œ ì›í•˜ëŠ” API í™•ì¸
    String[] yarnResource = {"clusterMetrics", "clusterInfo"};

    for(int i=0; i<yarnResource.length; i++) {

      //STEP1. GET JSON
      String responseData = ""; //ì‘ë‹µë°ì´í„°
      switch (yarnResource[i]) {
        case "clusterMetrics": 
          responseData = HttpUtil.connectGET(YARN_RESOURCE_METRIC);
          break;
        case "clusterInfo": 
          responseData = HttpUtil.connectGET(YARN_RESOURCE_INFO);
          break;
      }
      System.out.println((yarnResource[i] + " => GET: " + responseData);

      //Map ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ ì‹¶ì€ê²½ìš° ==> jsonToMap(responseData);
      //List<Map> ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ ì‹¶ì€ê²½ìš° ==> jsonToListMap(responseData);

      resultList.add(jsonToListMap(responseData));
    }
    
  } catch (Exception e) {
    e.printStackTrace();		
  } 
    
  return resultJSON;
}

```
  
> â—<span style='color:green'><b><I>ê³¼ì •</I></b></span>  
> ğŸ’¡ JSON ë¬¸ìì—´ì„ ë°›ì•„ì„œ ê°€ê³µ í›„ ë¦¬í„´í•œë‹¤.  
> ğŸ’¡ - HTTP ìœ í‹¸ í˜¸ì¶œ   
> ğŸ’¡ - JSON ìœ í‹¸ í˜¸ì¶œ  


## HttpUtil.java
### ì°¸ê³  í¬ìŠ¤íŒ…
```
ìë°”API HTTP í•¸ë“¤ë§ ìœ í‹¸
```

## StringUtil.java
```java
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;

```

### mapToStrJson() : JSONë§µ > ì™„ì „í•œJSONë¬¸ìì—´
```java
/*********************
 * map ê°ì²´ë¥¼ jsê°€ í•¸ë“¤ë§ í•  ìˆ˜ ìˆëŠ” ì™„ì „í•œ json í˜•íƒœ ë¬¸ìì—´ë¡œ ë³€í™˜<br>
 *  
 * @param mapJson - Map<String, Object>
 * @return String - ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ëœ ë¬¸ìì—´
 * @throws
 *********************/
public static String mapToStrJson(Map<String, Object> mapStrJson) {

  StringBuilder jsonStringBuilder = new StringBuilder();
  jsonStringBuilder.append("{");
  boolean firstEntry = true; //ì²«íšŒ skip
  for (Map.Entry<String, Object> entry : mapStrJson.entrySet()) {
      if (!firstEntry) {
          jsonStringBuilder.append(",");
      }
      jsonStringBuilder.append("\"").append(entry.getKey()).append("\":");
      Object value = entry.getValue();
      if (value instanceof String) {
          jsonStringBuilder.append("\"").append(value).append("\"");
      } else if(value instanceof Double) {
      	// Gson ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í‚¤ê°’ì´ int í˜•ì€ double ë¡œ ì²˜ë¦¬
      	jsonStringBuilder.append("\"").append(value).append("\"");
      } else {
          jsonStringBuilder.append(value);
      }
      firstEntry = false;
  }
  jsonStringBuilder.append("}");

  String jsonString = jsonStringBuilder.toString();
  System.out.println(jsonString);
  return jsonString;
}

```

### jsonToMap() : JSONë¬¸ìì—´ > ë§µ
```java
/*********************
 * json í˜•íƒœì˜ ë¬¸ìì—´ì„ ë§µ ê°ì²´ë¡œ ë³€í™˜<br>
 *  
 * @param json í˜•íƒœì˜ ë¬¸ìì—´
 * @return Map<String, Object>
 * @throws
 *********************/
public static Map<String, Object> jsonToMap(String strJson) {

  Map<String, Object> mapJson = new HashMap<String, Object>();

  JsonObject jsonObject = JsonParser.parseString(resJson).getAsJsonObject();
  for(String key : jsonObject.keySet()) {
    //String strKey = key; //í‚¤
    JsonElement jsonElement = jsonObject.get(key);
    Object value = getJsonToObj(jsonElement);

    mapJson.put(key, value);
  }
  return mapJson;
}

```

### jsonToListMap() : JSONë¬¸ìì—´ > ë¦¬ìŠ¤íŠ¸ë§µ
```java
/*********************
 * json í˜•íƒœì˜ ë¬¸ìì—´ì„ ë¦¬ìŠ¤íŠ¸ë§µ ê°ì²´ë¡œ ë³€í™˜<br>
 *  
 * @param json í˜•íƒœì˜ ë¬¸ìì—´
 * @return List<Map<String, Object>>
 * @throws
 *********************/
public static List<Map<String, Object>> jsonToListMap(String strJson) {

  List<Map<String, Object>> listJson = new ArrayList<Map<String, Object>>();

  JsonObject jsonObject = JsonParser.parseString(resJson).getAsJsonObject();
  for(String key : jsonObject.keySet()) {
    //String strKey = key; //í‚¤
    JsonElement jsonElement = jsonObject.get(key);
    Object value = getJsonToObj(jsonElement);
    Map<String, Object> mapJson = new HashMap<String, Object>();
    mapJson.put(key, value);

    listJson.add(mapJson);
  }
  return listJson;
}

```

### (ì¤‘ìš”) getJsonToObj() : JSONì—˜ë¦¬ë¨¼íŠ¸ > ì˜¤ë¸Œì íŠ¸
```java
/*********************
 * com.google.gson.JsonElement.JsonObject ê°ì²´ë¥¼<br>
 * Object íƒ€ì…ìœ¼ë¡œ ë³€í™˜
 * í”„ë¡ íŠ¸ì—ì„œ í•¸ë“¤ë§ì‹œ ë‹¤ì–‘í•œ íƒ€ì…ì„ êº¼ë‚¼ ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬í•œë‹¤.
 *  
 * @param com.google.gson.JsonElement
 * @return Object
 * @throws
 *********************/
public static Object getJsonToObj(JsonElement jsonElement) {
  //ê¸°ë³¸ì ì¸ ì›ì‹œ íƒ€ì…ì¸ì§€ í™•ì¸
  if (jsonElement.isJsonPrimitive()) {
    if (jsonElement.getAsJsonPrimitive().isString()) {
      return jsonElement.getAsString();
    } else if (jsonElement.getAsJsonPrimitive().isNumber()) {
      return jsonElement.getAsNumber();
    } else if (jsonElement.getAsJsonPrimitive().isBoolean()) {
      return jsonElement.getAsBoolean();
    }
  }
  //ê°ì²´ì¸ê²½ìš° ì¬ê·€í˜¸ì¶œë¡œ ì›ì‹œíƒ€ì…ê¹Œì§€ ì²˜ë¦¬
  else if (jsonElement.isJsonObject()) {
    JsonObject jsonObject = jsonElement.getAsJsonObject();
    Map<String, Object> nestedMap = new HashMap<String, Object>();
    for (String key : jsonObject.keySet()) {
      JsonElement resultElement = jsonObejct.get(key);
      nestedMap.put(key, getJsonToObj(resultElement));
    }
    return nestedMap;
  }
  return null;
}

```

