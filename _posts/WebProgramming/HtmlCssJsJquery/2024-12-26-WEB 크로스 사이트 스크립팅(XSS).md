---
title:  "WEB í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(XSS)"
excerpt: "WEB í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(XSS) ì…ë‹ˆë‹¤."

categories:
  - html-css-js-jquery
tags:
  - [HTML,CSS,JS,jquery]

toc: true
toc_sticky: true

last_modified_at: 2024-12-26T20:00:00-05:00:00
---


## ìš”ì•½
> â—<span style='color:green'>***ê³µí†µì ***</span>  
> ğŸ’¡ <span style='color:red'>**ë¦¬ë‹¤ì´ë ‰íŠ¸ì™€ í¬ì›Œë“œëŠ” í˜ì´ì§€ê°€ ì „í™˜ëœë‹¤ëŠ” ì ì€ ë¹„ìŠ·í•´ë³´ì¸ë‹¤.**</span>  
>    
> â—<span style='color:green'><b><I>***ë¦¬ë‹¤ì´ë ‰íŠ¸ì™€ í¬ì›Œë“œ***</I></b></span>  
> ğŸ’¡ <span style='color:red'>**ë¦¬ë‹¤ì´ë ‰íŠ¸ëŠ” í˜ì´ì§€ ì „í™˜ ì£¼ì²´ê°€ í´ë¼ì´ì–¸íŠ¸ì´ë©°, í¬ì›Œë“œëŠ” í˜ì´ì§€ ì „í™˜ ì£¼ì²´ê°€ ì„œë²„ì´ë‹¤.**</span>  

## ì·¨ì•½ì 
### AS-IS
```js
<script>
function injectionFilt(param) {
    param = param.replace(/</gi, "");
    param = param.replace(/>/gi, "");
    param = param.replace(/&/gi, "");
    param = param.replace(/\//gi, "");
    param = param.replace(/%/g, "");
	return param;
} 
</script>

<script>
$(document).ready(function() {
	var flag = "<%=(String) request.getParameter("otherServerData")%>";
	flag = injectionFilt(flag);
	
	if(flag == "null") {
	     //ë¡œê·¸ì¸í˜ì´ì§€ ì´ë™
	} else {
	     history.replaceState({}, null, location.pathname);
	}
});
</script>

```

## í•´ê²°1
### TO-BE
```js
<script>
function escapeHtml(str) {
    return str.replace(/[&<>"']/g, function (match) {
        const escape = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return escape[match];
    });
}

function encodeUserInput(param) {
    return encodeURIComponent(param);
}

$(document).ready(function() {
    // ì™¸ë¶€ ì‹œìŠ¤í…œì—ì„œ ì „ë‹¬ë°›ì€ wso íŒŒë¼ë¯¸í„°ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
    var flag = "<%= request.getParameter('otherServerData') %>";
    flag = escapeHtml(flag); // XSS ë°©ì§€
    flag = encodeUserInput(flag); // URL ì¸ì½”ë”© ì²˜ë¦¬

    console.log(flag); // ìµœì¢…ì ìœ¼ë¡œ ì•ˆì „í•œ flag ê°’ ì¶œë ¥

    if (flag === "null") {
        //ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = "/otp-login";
    } else {
        // í˜ì´ì§€ URLì„ ë³€ê²½í•˜ì—¬ history state ì²˜ë¦¬
        history.replaceState({}, null, location.pathname);
    }
});
</script>

```


## ë³´ì•ˆ ê°•í™” ì 
### XSS ë°©ì§€ ê°•í™”  
> â—<span style='color:green'><b><I>***function escapeHtml() {...} ì‚¬ìš©***</I></b></span>  
> ğŸ’¡ <span style='color:red'>**escapeHtml í•¨ìˆ˜ëŠ” HTML íŠ¹ìˆ˜ ë¬¸ìë¥¼ HTML ì—”í‹°í‹°ë¡œ ë³€í™˜í•œë‹¤. (HTMLíƒœê·¸ ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ ì‹¤í–‰ë°©ì§€ íš¨ê³¼)**</span>  
> - <span style='color:red'> \<ëŠ” \&lt; </span>  
> - <span style='color:red'> \>ëŠ” \&gt;  </span>
>  
> ğŸ’¡ <span style='color:red'>**ê¸°ì¡´ ì½”ë“œì—ì„œëŠ” ë‹¨ìˆœíˆ ë¬¸ìë¥¼ ì œê±°í•˜ëŠ” ë°©ì‹ì´ì—ˆìœ¼ë‚˜, ì´ ë°©ì‹ì€ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì¸ì‹í•˜ê³  ê·¸ì— ë§ëŠ” ì•ˆì „í•œ HTML ì—”í‹°í‹°ë¡œ ë³€í™˜í•˜ì—¬ ì¶œë ¥.**</span>


### XSS ë°©ì§€ ê°•í™” URL ì¸ì½”ë”© (encodeURIComponent ì‚¬ìš©)  
> â—<span style='color:green'><b><I>***URL-safe í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”© íš¨ê³¼ë¶€ì—¬***</I></b></span>  
> ğŸ’¡ <span style='color:red'>**encodeURIComponentëŠ” ì‚¬ìš©ì ì…ë ¥ê°’ì„ URL-safe í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•˜ì—¬ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•  ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œë¥¼ ë°©ì§€í•œë‹¤.**</span>  
> - <span style='color:red'>&, =, ?, / ë“±ì˜ íŠ¹ìˆ˜ ë¬¸ìê°€ URL ë‚´ì—ì„œ ì˜ëª» ì²˜ë¦¬ë˜ì§€ ì•Šë„ë¡ í•œë‹¤.</span>  
>   
> ğŸ’¡ <span style='color:red'>**ì´ ë°©ë²•ì€ URL íŒŒë¼ë¯¸í„°ê°€ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë˜ë„ë¡ ë³´ì¥í•œë‹¤. (AS-ISì—ì„œëŠ” URL ì¸ì½”ë”©ì„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, URL íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©ì ì…ë ¥ì„ ì „ì†¡í•  ë•Œ ì˜ˆìƒì¹˜ ëª»í•œ ê²°ê³¼ê°€ ë°œìƒí•  ìˆ˜ ìˆì—ˆë‹¤.)**</span>


### ê¸°ì¡´ ì½”ë“œì˜ ë¬¸ì œì  (filterInjectionCmd)
- filterInjectionCmd í•¨ìˆ˜ëŠ” íŠ¹ì • ë¬¸ìë§Œ ì œê±°í•˜ì—¬ XSS ê³µê²©ì„ ë§‰ì„ ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ë°©ë²•ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.  
    - ì˜ˆë¥¼ ë“¤ì–´, ì•„ë˜ ì½”ë“œì™€ ê°™ì€ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ ì œê±°ë˜ì§€ ì•ŠëŠ”ë‹¤. \<ì™€ \>ë¥¼ ì œê±°í•˜ëŠ” ê²ƒì€ ì œí•œì ì¸ ë°©ë²•ì´ë‹¤.  
      
      ```js
      <script>alert("XSS")</script>
      ```
      
- \/ë‚˜ \%ì™€ ê°™ì€ ë¬¸ìë¥¼ ì œê±°í•˜ëŠ” ê²ƒì€ ì¼ë¶€ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì°¨ë‹¨í•  ìˆ˜ ìˆì§€ë§Œ, ì „ì²´ì ì¸ XSS ê³µê²©ì„ ë§‰ëŠ” ë°ì—ëŠ” í•œê³„ê°€ ìˆë‹¤.



## í•´ê²°2
### TO-BE
```js
<script>
function escapeHtml(str) {
    return str.replace(/[&<>"']/g, function (match) {
        const escape = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return escape[match];
    });
}

function encodeUserInput(param) {
    return encodeURIComponent(param);
}

$(document).ready(function() {
    // ì™¸ë¶€ ì‹œìŠ¤í…œì—ì„œ ì „ë‹¬ë°›ì€ wso íŒŒë¼ë¯¸í„°ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
    var flag = "<%= request.getParameter('otherServerData') %>";
    flag = escapeHtml(flag); // XSS ë°©ì§€
    flag = encodeUserInput(flag); // URL ì¸ì½”ë”© ì²˜ë¦¬

    console.log(flag); // ìµœì¢…ì ìœ¼ë¡œ ì•ˆì „í•œ flag ê°’ ì¶œë ¥

    if (flag === "null") {
        //ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = "/otp-login";
    } else {
        // í˜ì´ì§€ URLì„ ë³€ê²½í•˜ì—¬ history state ì²˜ë¦¬
        history.replaceState({}, null, location.pathname);
    }
});
</script>

```