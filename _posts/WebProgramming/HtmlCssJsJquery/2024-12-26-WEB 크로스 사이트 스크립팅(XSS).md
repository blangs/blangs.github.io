---
title:  "WEB í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(XSS)"
excerpt: "WEB í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(XSS) ì…ë‹ˆë‹¤."

categories:
  - html-css-js-jquery
tags:
  - [HTML,CSS,JS,jquery]

toc: true
toc_sticky: true

last_modified_at: 2024-12-26T20:00:00-05:00:00
---


## ìš”ì•½
> â—<span style='color:green'>***fn:escapeXml***</span>  
> ğŸ’¡ <span style='color:red'>**fn:escapeXmlì€ <, >, &, ", ' ë“±ì„ ì•ˆì „í•œ HTML ì—”í‹°í‹°(&lt;, &gt; ë“±)ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.**</span>  
>    
> â—<span style='color:green'><b><I>***\<c:out>***</I></b></span>  
> ğŸ’¡ <span style='color:red'>**\<c:out value="${param.dataName4}" />ë¥¼ ì‚¬ìš©í•  ê²½ìš°, ê¸°ë³¸ì ìœ¼ë¡œ Escape ì²˜ë¦¬ê°€ ì ìš©ë©ë‹ˆë‹¤.**</span>  




## XSSìœ í˜•1 : (HTMLíƒœê·¸ì˜ì—­) ì§ì ‘ ì¶œë ¥ìœ¼ë¡œ XSS ê³µê²© 
### ë¬¸ì œ
```java
// JAVA
model.addAttribute("dataName1", "</script><script>alert('XSS ì–´íƒ1');</script><script>");

model.addAttribute("dataName2", "</script><script>alert('XSS ì–´íƒ2');</script><script>");
```

```js
// html
<html>
<body>
	<!-- CASE1. c:out ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ ë¹„í™œì„±í™”ë¡œ ì§ì ‘ì¶œë ¥ ê³µê²© -->
	<c:out value="${dataName1}" escapeXml="false"/>

	<!-- CASE2. ì§ì ‘ì¶œë ¥ XSS ê³µê²© -->
	${dataName2}
</body>
</html>

```

### í•´ê²°
```js
// html
<html>
<body>
    <!-- CASE1_í•´ê²°. escapeXml ì†ì„±(ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬) ê¸°ë³¸ê°’ì´ trueì´ë¯€ë¡œ, íŠ¹ë³„íˆ ë³€ê²½í•˜ì§€ ì•ŠëŠ” í•œ ì•ˆì „í•˜ë‹¤. -->
	<c:out value="${dataName1}"/>
	
	<!-- CASE2_í•´ê²°. jstlì˜ escapleXml ê¸°ëŠ¥ì„ ì‚¬ìš©í•œ XSS ë°©ì§€  -->
	'${fn:escapeXml(dataName2)}';
</body>
</html>

```

## XSSìœ í˜•2 : (ìŠ¤í¬ë¦½íŠ¸ì˜ì—­) ìŠ¤í¬ë¦½íŠ¸ ì¢…ë‹¨ì ì„ ì´ìš©í•œ ê³µê²©
### ë¬¸ì œ
```java
// JAVA
model.addAttribute("dataName3", "</script><script>alert('XSS ìœ í˜•3 ê³µê²©');</script><script>");

```

```js
// JS
<script>
    // ë°©ë²• 3 : ìŠ¤í¬ë¦½íŠ¸íƒœê·¸ì˜ ì¢…ë‹¨ì ì„ ì´ìš©í•œ ê³µê²©
	var data3 = ${dataName3}dddd;
</script>

```

### í•´ê²°
```js
//JS
<script>
    var data3 = '<c:out value="${dataName3}"/>';
    var data3 = '<c:out value="${fn:escapeXml(dataName3)}"/>'.replace(/'/g, "\\'");
</script>

```



## XSS ìœ í˜•3 : (HTMLíƒœê·¸ì˜ì—­, ìŠ¤í¬ë¦½íŠ¸ì˜ì—­) ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ì´ìš©í•œ ê³µê²©
### ë¬¸ì œ
```bash
# (HTMLíƒœê·¸ì˜ì—­) ë¸Œë¼ìš°ì € ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì…ë ¥ í›„ ìš”ì²­1
http://localhost:9090//index?dataName4=<script>alert('XSS ìœ í˜•4 ê³µê²©');</script>

# (ìŠ¤í¬ë¦½íŠ¸ì˜ì—­) ë¸Œë¼ìš°ì € ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì…ë ¥ í›„ ìš”ì²­2
http://localhost:9090//index?dataName5=</script><script>alert('XSS ìœ í˜•5 ê³µê²©');</script><script>

```

```js
// html
<html>
<body>
    <!-- HTML íƒœê·¸ì˜ì—­ -->
    <%= request.getParameter("dataName4") %>
</body>
<script>
    // ìŠ¤í¬ë¦½íŠ¸ì˜ì—­
    var data5 = "<%=request.getParameter("dataName5")%>";
</script>
</html>

```

### í•´ê²°
```js
// html
<html>
<body>
    <!-- HTML íƒœê·¸ì˜ì—­ -->
    ${fn:escapeXml(param.dataName4)}
</body>
<script>
    // ìŠ¤í¬ë¦½íŠ¸ì˜ì—­
    // JSON í˜•ì‹ ìœ ì§€ê°€ í•„ìš”í•œ ê²½ìš° (ì˜ˆ: JSON.parse)
    var data5 = JSON.parse('<%= request.getParameter("dataName5").replace(/["'\\]/g, "\\$&").replace(/\u0000/g, "\\0") %>');

    // HTML ì¶œë ¥ì´ë‚˜ ë‹¨ìˆœ ë¬¸ìì—´ ì²˜ë¦¬ë¡œ XSS ë°©ì§€ê°€ ëª©ì ì¸ ê²½ìš°
    var data5 = JSON.stringify('${fn:escapeXml(dataName5)}');

</script>
</html>

```

- JSON.stringifyëŠ” ë°ì´í„° Escapeë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©° JSON.parseë³´ë‹¤ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì„œë²„ì—ì„œ ì œê³µëœ ë°ì´í„°ê°€ JSON í˜•ì‹ì´ë¼ë©´ JSON.parseë¥¼ ì‚¬ìš©, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ JSON.stringifyë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.












## ì‘ì„±ì¤‘
### AS-IS
```js
<script>
function injectionFilt(param) {
    param = param.replace(/</gi, "");
    param = param.replace(/>/gi, "");
    param = param.replace(/&/gi, "");
    param = param.replace(/\//gi, "");
    param = param.replace(/%/g, "");
	return param;
} 
</script>

<script>
$(document).ready(function() {
	var flag = "<%=(String) request.getParameter("otherServerData")%>";
	flag = injectionFilt(flag);
	
	if(flag == "null") {
	     //ë¡œê·¸ì¸í˜ì´ì§€ ì´ë™
	} else {
	     history.replaceState({}, null, location.pathname);
	}
});
</script>

```

## í•´ê²°1
### TO-BE
```js
<script>
function escapeHtml(str) {
    return str.replace(/[&<>"']/g, function (match) {
        const escape = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return escape[match];
    });
}

function encodeUserInput(param) {
    return encodeURIComponent(param);
}

$(document).ready(function() {
    // ì™¸ë¶€ ì‹œìŠ¤í…œì—ì„œ ì „ë‹¬ë°›ì€ wso íŒŒë¼ë¯¸í„°ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
    var flag = "<%= request.getParameter('otherServerData') %>";
    flag = escapeHtml(flag); // XSS ë°©ì§€
    flag = encodeUserInput(flag); // URL ì¸ì½”ë”© ì²˜ë¦¬

    console.log(flag); // ìµœì¢…ì ìœ¼ë¡œ ì•ˆì „í•œ flag ê°’ ì¶œë ¥

    if (flag === "null") {
        //ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = "/otp-login";
    } else {
        // í˜ì´ì§€ URLì„ ë³€ê²½í•˜ì—¬ history state ì²˜ë¦¬
        history.replaceState({}, null, location.pathname);
    }
});
</script>

```


## ë³´ì•ˆ ê°•í™” ì 
### XSS ë°©ì§€ ê°•í™”  
> â—<span style='color:green'><b><I>***function escapeHtml() {...} ì‚¬ìš©***</I></b></span>  
> ğŸ’¡ <span style='color:red'>**escapeHtml í•¨ìˆ˜ëŠ” HTML íŠ¹ìˆ˜ ë¬¸ìë¥¼ HTML ì—”í‹°í‹°ë¡œ ë³€í™˜í•œë‹¤. (HTMLíƒœê·¸ ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ ì‹¤í–‰ë°©ì§€ íš¨ê³¼)**</span>  
> - <span style='color:red'> \<ëŠ” \&lt; </span>  
> - <span style='color:red'> \>ëŠ” \&gt;  </span>
>  
> ğŸ’¡ <span style='color:red'>**ê¸°ì¡´ ì½”ë“œì—ì„œëŠ” ë‹¨ìˆœíˆ ë¬¸ìë¥¼ ì œê±°í•˜ëŠ” ë°©ì‹ì´ì—ˆìœ¼ë‚˜, ì´ ë°©ì‹ì€ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì¸ì‹í•˜ê³  ê·¸ì— ë§ëŠ” ì•ˆì „í•œ HTML ì—”í‹°í‹°ë¡œ ë³€í™˜í•˜ì—¬ ì¶œë ¥.**</span>


### XSS ë°©ì§€ ê°•í™” URL ì¸ì½”ë”© (encodeURIComponent ì‚¬ìš©)  
> â—<span style='color:green'><b><I>***URL-safe í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”© íš¨ê³¼ë¶€ì—¬***</I></b></span>  
> ğŸ’¡ <span style='color:red'>**encodeURIComponentëŠ” ì‚¬ìš©ì ì…ë ¥ê°’ì„ URL-safe í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•˜ì—¬ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•  ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œë¥¼ ë°©ì§€í•œë‹¤.**</span>  
> - <span style='color:red'>&, =, ?, / ë“±ì˜ íŠ¹ìˆ˜ ë¬¸ìê°€ URL ë‚´ì—ì„œ ì˜ëª» ì²˜ë¦¬ë˜ì§€ ì•Šë„ë¡ í•œë‹¤.</span>  
>   
> ğŸ’¡ <span style='color:red'>**ì´ ë°©ë²•ì€ URL íŒŒë¼ë¯¸í„°ê°€ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë˜ë„ë¡ ë³´ì¥í•œë‹¤. (AS-ISì—ì„œëŠ” URL ì¸ì½”ë”©ì„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, URL íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©ì ì…ë ¥ì„ ì „ì†¡í•  ë•Œ ì˜ˆìƒì¹˜ ëª»í•œ ê²°ê³¼ê°€ ë°œìƒí•  ìˆ˜ ìˆì—ˆë‹¤.)**</span>


### ê¸°ì¡´ ì½”ë“œì˜ ë¬¸ì œì  (filterInjectionCmd)
- filterInjectionCmd í•¨ìˆ˜ëŠ” íŠ¹ì • ë¬¸ìë§Œ ì œê±°í•˜ì—¬ XSS ê³µê²©ì„ ë§‰ì„ ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ë°©ë²•ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.  
    - ì˜ˆë¥¼ ë“¤ì–´, ì•„ë˜ ì½”ë“œì™€ ê°™ì€ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ ì œê±°ë˜ì§€ ì•ŠëŠ”ë‹¤. \<ì™€ \>ë¥¼ ì œê±°í•˜ëŠ” ê²ƒì€ ì œí•œì ì¸ ë°©ë²•ì´ë‹¤.  
      
      ```js
      <script>alert("XSS")</script>
      ```
      
- \/ë‚˜ \%ì™€ ê°™ì€ ë¬¸ìë¥¼ ì œê±°í•˜ëŠ” ê²ƒì€ ì¼ë¶€ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì°¨ë‹¨í•  ìˆ˜ ìˆì§€ë§Œ, ì „ì²´ì ì¸ XSS ê³µê²©ì„ ë§‰ëŠ” ë°ì—ëŠ” í•œê³„ê°€ ìˆë‹¤.



## í•´ê²°2
### TO-BE
```js
<script>
function escapeHtml(str) {
    return str.replace(/[&<>"']/g, function (match) {
        const escape = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return escape[match];
    });
}

function encodeUserInput(param) {
    return encodeURIComponent(param);
}

$(document).ready(function() {
    // ì™¸ë¶€ ì‹œìŠ¤í…œì—ì„œ ì „ë‹¬ë°›ì€ wso íŒŒë¼ë¯¸í„°ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
    var flag = "<%= request.getParameter('otherServerData') %>";
    flag = escapeHtml(flag); // XSS ë°©ì§€
    flag = encodeUserInput(flag); // URL ì¸ì½”ë”© ì²˜ë¦¬

    console.log(flag); // ìµœì¢…ì ìœ¼ë¡œ ì•ˆì „í•œ flag ê°’ ì¶œë ¥

    if (flag === "null") {
        //ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = "/otp-login";
    } else {
        // í˜ì´ì§€ URLì„ ë³€ê²½í•˜ì—¬ history state ì²˜ë¦¬
        history.replaceState({}, null, location.pathname);
    }
});
</script>

```